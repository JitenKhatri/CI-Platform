@using CI_Platform.Models.ViewModels
@using System.Security.Claims
@{
    Layout = null;
    var userName = Context.User.Identity.Name;
}
@model TimesheetViewModel
<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mission-Detail</title>
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <link href="~/css/landing.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.6/dist/sweetalert2.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
</head>

<body>
  <div class="container-fluid p-0">
    <div class="row header">
      <div class="col d-flex flex-row justify-content-center">
        <a asp-controller="Story" asp-action="Story" style="text-decoration:none;" class="mx-1 mx-sm-4">Stories</a>
        <div class="dropdown">
          <button class="dropdown-toggle" type="button" data-bs-toggle="dropdown">
            Policy <img src="~/images/drop-down.png" class="mx-2" />
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" href="#">Volunteering</a></li>
            <li><a class="dropdown-item" href="#">Sponsored</a></li>
          </ul>
        </div>
      </div>
      <div class="col p-0">
        <div class="dropdown">
          <button
            class="dropdown-toggle profile"
            type="button"
            data-bs-toggle="dropdown" >
            <img src="~/images/user-img.png" class="profileimg" />
            <span class="mx-2 d-none d-sm-block">@userName</span>
            <img
              src="~/images/drop-down.png"
              class="mx-1 drop-down d-none d-sm-block"
            />
          </button>
          <ul class="dropdown-menu">
            <li><a class="dropdown-item" asp-controller="UserAuthentication" asp-action="EditProfile">My Profile</a></li>
            <li><a class="dropdown-item" asp-controller="Mission" asp-action="Volunteering_Timesheet">Timesheet</a></li>
            <li><a class="dropdown-item" asp-controller="UserAuthentication" asp-action="Logout">Logout</a></li>
          </ul>
        </div>
      </div>
    </div>
   </div>
   <div class="container">
    <h4 class="my-5">
        Volunteering Timesheet
    </h4>

    <div class="row justify-content-between mt-4" style="height:400px;">
        <div class="timesheet-box h-100 col-lg-6 px-4" style="width:48%;">
            <div class="d-flex justify-content-between  align-items-center  mt-4">
                <span>Volunteering Hours</span>
                <button data-bs-toggle="modal" data-bs-target="#time" class="btn applybutton d-flex justify-content-between align-items-center" ><img src="~/images/add.png" class="me-2" style="height:13px;"/><span>Add</span></button>
            </div>
            <div class="mt-4 row table-responsive">
                 <table class="table table-borderless">
                     <tbody class="time-timesheets">
                    <tr>
                        <th>Mission</th>
                        <th>Date</th>
                        <th>Hours</th>
                        <th>Minutes</th>
                        <th> </th>
                    </tr>
                    @{
                        foreach(var item in Model.Timesheets)
                        {
                            if (item.Action is null)
                            {
                                <tr id='timesheet-@item.TimesheetId'>
                                <td>@item.Mission.Title.ToString().Substring(0,15)</td>
                                <td>@item.DateVolunteered.ToString("dd-MM-yyyy")</td>
                                <td>@item.Time.ToString().Substring(0,2)</td>
                                <td>@item.Time.ToString().Substring(3,5)</td>
                                <td>
                                <img data-bs-toggle="modal" data-bs-target="#time"
                                onclick="edittimesheet(@item.TimesheetId,@item.MissionId,
                                        '@item.Time.ToString().Substring(0,2)','@item.Time.ToString().Substring(3,5)','@item.Notes','time')" 
                                src="~/images/editing.png" class="edbutton" alt=""/>
                                        <img src="~/images/bin.png" onclick="deletetimesheet(@item.TimesheetId)"
                                        class="ms-2 edbutton" alt="" />
                                        </td>
                                        
                                        
                               </tr>
                            }
                        }
                        }
                        </tbody>
                </table>
            </div>


        </div>
        <div class="timesheet-box h-100 col-lg-6 px-4" style="width:48%;">
             <div class="d-flex justify-content-between align-items-center mt-4">
                <span>Volunteering Goals</span>
                <button data-bs-toggle="modal" data-bs-target="#goal" class="btn d-flex applybutton justify-content-between align-items-center"><img src="~/images/add.png" class="me-2" style="height:13px;"/><span>Add</span></button>
            </div>
            <div class="mt-4 row goal-table table-responsive">
                <table class="table table-borderless">
                    <tbody class="goal-timesheets">
                    <tr>
                        <th>Mission</th>
                        <th>Date</th>
                        <th>Action</th>
                        <th></th>
                    </tr>

                    @{
                        foreach(var item in Model.Timesheets)
                        {
                            if (item.Action is not null)
                            {
                                <tr id='timesheet-@item.TimesheetId'>
                                <td>@item.Mission.Title.ToString().Substring(0,15)</td>
                                <td>@item.DateVolunteered.ToString("dd-MM-yyyy")</td>
                                <td>@item.Action</td><td>
                                <img onclick="edittimesheet(@item.TimesheetId,@item.MissionId,0,0,'@item.Notes','goal','@item.Action')"
                                data-bs-toggle="modal" data-bs-target="#goal" src="~/images/editing.png" class="edbutton" alt=""/>
                                        <img src="~/images/bin.png" onclick="deletetimesheet(@item.TimesheetId)"
                                        class="ms-2 edbutton" alt="" /></td>
                                        </tr>
                            }
                        }
                        }
                        </tbody>
                </table>
                    
</div>
</div>
</div>
</div>



@*Modals*@

<div class="modal fade" id="time" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Please Enter Below Volunteering Hours</h5>
      </div>
      <div class="modal-body">
       <div class="mission">
           <label class="form-label mt-3">Mission</label>
           <select class="form-select time-mission me-3" aria-label="Select Mission">
  <option value=0 disabled  selected>Select Your Mission</option>
                        @{
                            foreach (var item in Model.Missions)
                            {
                                if (@item.Mission_type == "TIME")
                                {
                                    <option value=@item.Mission_id id=@item.Mission_id>@item.Title</option>
                                }
      }
  }
  </select>
  <span class="text-danger d-none time-mission-empty">Mission Required</span>
       </div>
       <div>
           <label class="form-label mt-3">Date Volunteered</label>
            <input type="date" max=@DateTime.Now.ToString("dd/MM/yyyy") class="form-control time-date"/>
            <span class="text-danger d-none time-date-empty">Date Required</span>
       </div>
       <div class="d-flex justify-content-between w-100">
           <div style="width:48%;">
           <label class="form-label mt-3">Hours</label>
            <input type="number" placeholder="Enter Spent Hours"  class="form-control time-hours" />
            <span class="text-danger d-none time-hours-valid">Enter Valid Hours</span>
            </div>
            <div style="width:48%;">
           <label class="form-label mt-3">Minutes</label>
            <input type="number" placeholder="Enter Spent Minutes" class="form-control time-min"/>
            <span class="text-danger d-none time-min-valid">Enter Valid mins</span>
            </div>
       </div>
       <div>
           <label class="form-label mt-3">Message</label>
            <textarea class="form-control time-message" rows=5 placeholder="Enter Your Message"></textarea>
            <span class="text-danger d-none time-message-empty">Message Required</span>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn applybutton" onclick="clear_modal('time')" data-bs-dismiss="modal">Cancel</button>
        <button type="button" onclick="timedata()" class="btn applybutton">Submit</button>
      </div>
    </div>
  </div>
</div>


@*for goal*@

<div class="modal fade" id="goal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Please Enter Below Volunteering Goal</h5>
      </div>
      <div class="modal-body">
       <div class="mission">
           <label class="form-label mt-3">Mission</label>
           <select class="form-select me-3" id="mission_goal" aria-label="Select Mission">
  <option disabled value=0 selected>Select Your Mission</option>
                        @{
                             foreach (var item in Model.Missions)
                            {
                                if (@item.Mission_type == "GO")
                                {
                                    <option value='mission_id-@item.Mission_id goal_object-@item.Goal_object' id='mission-@item.Mission_id'>@item.Title</option>
                                }
      }
  }
  </select>
  <span class="text-danger d-none goal-mission">Select Mission first</span>
       </div>
         <div>
           <label class="form-label mt-3">Actions</label>
            <input type="number" id="action" placeholder="Enter Actions"   class="form-control" />
            <span class="text-danger d-none action-empty">Actions Required</span>
            <span class="text-danger d-none action-notvalid">Enter Valid Action</span>
       </div>
       <div>
           <label class="form-label mt-3">Date Volunteered</label>
            <input type="date" id="goal-date" max=@DateTime.Now.ToString("dd/MM/yyyy")  class="form-control"/>
            <span class="text-danger d-none date-empty">Date Required</span>
       </div>
       <div>
           <label class="form-label mt-3">Message</label>
            <textarea class="form-control" id="goal-message" rows=5  placeholder="Enter Your Message"></textarea>
            <span class="text-danger d-none message-empty">Message Required</span>
            </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn applybutton" onclick="clear_modal('goal')" data-bs-dismiss="modal">Cancel</button>
        <button type="button" onclick="goaldata()" class="btn applybutton">Submit</button>
      </div>
    </div>
  </div>
</div>
 <input id="timesheet-id" type="hidden" />           
    
  
 
 
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.3/jquery.min.js" integrity="sha512-STof4xm1wgkfm7heWqFJVn58Hm3EtS31XFaagaa8VMReCXAkQnJZ+jEy8PCC/iT18dFy95WcExNHFTqLyp72eQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.6/dist/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.16.6/dist/sweetalert2.min.js"></script>
  <script src="~/js/timesheet.js"></script>

</body>
  <footer style="position:fixed;"> <a class="text-muted" style="    margin-left: 10%;
    text-decoration: none;" asp-controller="Home" asp-action="Privacy"> Privacy policy</a></footer>
</html>